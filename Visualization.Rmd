---
title: "Visualization"
author: "aaron till"
date: "5/29/2018"
output: html_document
---

```{r}
library(ggplot2)
library(ggthemes)
library(ggmap)
library(car)
library(gridExtra)
#library(Scales)
```

6 figures allowed

Captions < 300 words


# Starting spatial distribution

```{r}

Wisconsin_map <- get_map('Stevens Point, Wisconsin', zoom = 7, maptype = 'toner-lite', source = 'stamen')

```

```{r}




MME_lakes_of_wisconsin <- ggmap(Wisconsin_map) +
  geom_point(data = filter(main_data, MME == 1), aes(x = V1, V2))


MME_lakes_of_wisconsin_dif_categories <- ggmap(Wisconsin_map) +
  geom_point(data = filter(main_data, MME == 1 & Summerkill == 1), aes(x = V1, V2), fill = 'red', shape = 21) +
  geom_point(data = filter(main_data, MME == 1 & Winterkill == 1), aes(x = V1, V2), fill = 'blue', shape = 21) +
  geom_point(data = filter(main_data, MME == 1 & Infection == 1), aes(x = V1, V2), fill = 'green', shape = 21) +
   geom_point(data = filter(main_data, MME == 1 & Anthropogenic == 1), aes(x = V1, V2), fill = 'orange', shape = 21)


color_seperated_lakes_of_wisconsin <- ggmap(Wisconsin_map) +
  geom_point(data = filter(main_data, MME == 0), aes(x = V1, V2), fill = 'blue', shape = 21)+
  geom_point(data = filter(main_data, MME == 1), aes(x = V1, V2), fill = 'red', shape = 21)
  
color_seperated_lakes_of_wisconsin

```


# bBoxplot of killtype mean temps

```{r}

mean_surf(combined_data_restricted) %>%
  filter(Month == 'Jul' | Month == 'Jun' | Month == 'Aug' | Month == 'May' | Month == 'Sep') %>%
  mutate(Cause.Category.4 = replace(as.character(Cause.Category.4), which(is.na(Cause.Category.4)), 'SUMMERTIME NON-EVENT')) %>%
  filter(Cause.Category.4 == 'INFECTIOUS AGENT' | Cause.Category.4 == 'SUMMERKILL' | Cause.Category.4 == 'SUMMERTIME NON-EVENT' | Cause.Category.4 == 'ANTHROPOGENIC CONDITION') %>%   
ggplot(aes(y = temperature,x = Cause.Category.4)) +
  theme_tufte() +
  ylab('Mean Surface Temperature May - September')+
  xlab('Category of Killtype')+
  geom_boxplot()



```



# AV plot for Summerkills 

Taken from feature selection of lasso regression of summerkill in modeling.Rmd


```{r sample}

set.seed(1234)

summer_sample_main_data <- merge(filter(main_data, Summerkill == 1), sample_n(filter(main_data, Summerkill == 0), size = 500), all = TRUE)

logreg_summerkill <- glm(Summerkill ~ Mean_Surf_Temp + Cumulative_Above_0 + V2, family = 'binomial', data= summer_sample_main_data)
summary(logreg_summerkill)

```

```{r}



log_plot_summerkill <- avPlot(logreg_summerkill, variable = 'Mean_Surf_Temp',xlab = 'Residuals of Mean Surface Temperature', ylab = 'Residuals of Summerkill')


log_plot_summerkill      

```




# AV plot for Winterkill

Taken from lasso feature selection of winterkill only in modeling.Rmd

```{r sample}

set.seed(1234)

winter_sample_main_data <- merge(filter(main_data, Winterkill == 1), sample_n(filter(main_data, Winterkill == 0), size = 500), all = TRUE)

logreg_winterkill <- glm(Winterkill ~ Mean_Surf_Temp + Cumulative_Above_0 + V2, family = 'binomial', data= winter_sample_main_data)
summary(logreg_winterkill)

```

```{r}



log_plot_winterkill <- avPlot(logreg_winterkill, variable = 'Mean_Surf_Temp',xlab = 'Residuals of Mean Surface Temperature', ylab = 'Residuals of Summerkill')


log_plot_winterkill      

```




# Final projected MME by year & season (include original MME data for concurrent)}


```{r Creating Seasons}

reg_predictions$Season <- reg_predictions$Month
main_data$Season <- main_data$Month

reg_predictions$Season <- ifelse(reg_predictions$Month =='Apr'| reg_predictions$Month =='May', 'Spring', reg_predictions$Season)
main_data$Season <- ifelse(main_data$Month =='Apr'| main_data$Month =='May', 'Spring', main_data$Season)


reg_predictions$Season <- ifelse(reg_predictions$Month =='Mar'| reg_predictions$Month =='Dec'| reg_predictions$Month =='Jan'| reg_predictions$Month =='Feb', 'Winter', reg_predictions$Season)
main_data$Season <- ifelse(main_data$Month =='Mar'| main_data$Month =='Dec'| main_data$Month =='Jan'| main_data$Month =='Feb', 'Winter', main_data$Season)


reg_predictions$Season <- ifelse(reg_predictions$Month =='Sep'|reg_predictions$Month =='Jun'| reg_predictions$Month =='Jul'| reg_predictions$Month =='Aug', 'Summer', reg_predictions$Season)
main_data$Season <- ifelse(main_data$Month =='Sep'|main_data$Month =='Jun'| main_data$Month =='Jul'| main_data$Month =='Aug', 'Summer', main_data$Season)


reg_predictions$Season <- ifelse(reg_predictions$Month =='Oct'| reg_predictions$Month =='Nov', 'Fall', reg_predictions$Season)
main_data$Season <- ifelse(main_data$Month =='Oct'| main_data$Month =='Nov', 'Fall', main_data$Season)


reg_predictions$Season <-factor(reg_predictions$Season, levels=c('Summer', 'Spring', 'Winter', 'Fall'))
main_data$Season <-factor(main_data$Season, levels=c('Summer', 'Spring', 'Winter', 'Fall'))

```


```{r Actual Plots}


plot1<-main_data %>%
  filter(Summerkill == 1) %>%
ggplot(aes(x=factor(Year), fill=Season)) + 
  stat_count()+
  #geom_boxplot(color="black",aes(y=peak_temp, group=Year)) +
  ylab("Actual MMEs")+
  xlab("Period 1") +
  scale_x_discrete()+
  #guides(fill=FALSE) +
  theme_tufte()+
  ylim(0,120) +
  theme(axis.text.x=element_text(angle=45,hjust=1), legend.position = 'left') 
plot1

plot2<-reg+predictions %>%
  filter(Summerkill == 1) %>%
  filter(Year <2060) %>%
ggplot(aes(x=factor(Year), fill=Season)) +
  stat_count()+
  #geom_boxplot(color="black",aes(y=peak_temp, group=Year)) +
  ylab("Forecasted MMEs")+
  xlab("Period 1") +
  scale_x_discrete()+
  #guides(fill=FALSE) +
  theme_tufte()+
  ylim(0,120) +
  theme(legend = FALSE)
  #theme(axis.text.x=element_text(angle=45,hjust=1), legend.position = 'left') 
plot2



plot3<- reg_predictions %>%
  filter(MME == 1) %>%
  filter(Year >2060) %>%
ggplot(aes(x=factor(Year), fill=Season)) +
  stat_count()+
  #geom_boxplot(color="black",aes(y=peak_temp, group=Year)) +
  ylab(label = NULL)+
  xlab("Period 2") +
  scale_x_discrete()+
  #guides(fill=FALSE) +
  theme_tufte()+
  theme(axis.text.x=element_text(angle=45,hjust=1), legend.position = 'right') +
  ylim(0,120) 
plot3




grid.arrange(plot1,plot2,plot3, ncol = 2)

```




# final spatial probability dist.

```{r}


reg_predictions_spatial <- merge(shape_full, reg_predictions, all = FALSE)

logreg_at_risk_lakes_of_wisconsin <- ggmap(Wisconsin_map) + 
  geom_point(data = reg_predictions_spatial, aes(x = V1, V2, color = quantile))+
  scale_colour_brewer(type = "div")


```

