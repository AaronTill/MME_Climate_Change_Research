---
title: "Visualization"
author: "aaron till"
date: "5/29/2018"
output: html_document
---

```{r}
library(ggplot2)
library(ggthemes)
library(ggmap)
library(car)
library(gridExtra)
library(scales)
```

6 figures allowed

Captions < 300 words




# Boxplot of killtype mean temps

```{r}
combined_data_restricted <- combined_data_restricted %>%
  mutate(Cause.Category.4 = replace(as.character(Cause.Category.4), which(is.na(Cause.Category.4)), 'SUMMERTIME NON-EVENT')) 

boxplot1 <- mean_surf(combined_data_restricted) %>%
  filter(Month == 'Jul' | Month == 'Jun' | Month == 'Aug' | Month == 'Sep') %>%
  filter(Cause.Category.4 == 'INFECTIOUS AGENT' | Cause.Category.4 == 'SUMMERKILL' | Cause.Category.4 == 'SUMMERTIME NON-EVENT') %>%   
ggplot(aes(y = temperature,x = Cause.Category.4)) +
  theme_tufte() +
  ylab('Mean Surface Temperature')+
  xlab(NULL)+
  geom_boxplot()

boxplot2 <- mean_surf(combined_data_restricted) %>%
  filter(Month == 'Jul' | Month == 'Jun' | Month == 'Aug' | Month == 'Sep') %>%
  filter(Cause.Category.4 == 'INFECTIOUS AGENT' | Cause.Category.4 == 'SUMMERKILL' | Cause.Category.4 == 'SUMMERTIME NON-EVENT') %>%   
ggplot(aes(y = zscore_temp,x = Cause.Category.4)) +
  theme_tufte() +
  ylab('Zscore')+
  xlab('Category of Killtype')+
  geom_boxplot()+
  geom_hline(yintercept = 0, alpha = 0.3)

grid.arrange(boxplot1, boxplot2)


```
```{r Boxplot Anova}

anova_data <- mean_surf(combined_data_restricted) %>% filter(Month == 'Jul' | Month == 'Jun' | Month == 'Aug' | Month == 'Sep') %>% filter((Cause.Category.4 == 'INFECTIOUS AGENT' | Cause.Category.4 == 'SUMMERKILL' | Cause.Category.4 == 'SUMMERTIME NON-EVENT'))

anova_cause_Type <- aov(temperature ~ Cause.Category.4, anova_data)
summary(anova_cause_Type)
tuk <- TukeyHSD(anova_cause_Type)
tuk
```
```{r Boxplot Zscore Anova}
anova_zscore_cause_Type <- aov(zscore_peak_temp ~ Cause.Category.4,anova_data)
summary(anova_zscore_cause_Type)
tuk <- TukeyHSD(anova_zscore_cause_Type)
tuk

```


# AV plot for Summerkills 

Taken from feature selection of lasso regression of summerkill in modeling.Rmd + Season for controlling


```{r sample}

set.seed(1234)

summer_sample_main_data <- merge(filter(main_data, Summerkill == 1), sample_n(filter(main_data, Summerkill == 0), size = 300), all = TRUE)

logreg_summerkill <- glm(Summerkill ~ Mean_Surf_Temp + Cumulative_Above_0 + V2 + Season, family = 'binomial', data= summer_sample_main_data)
summary(logreg_summerkill)


logreg_summerkill_one_variable <- glm(Summerkill ~ Mean_Surf_Temp, family = 'binomial', data= filter(main_data, Season == 'Summer'))
summary(logreg_summerkill_one_variable)

```

```{r}

log_plot_summerkill_mean_surf <- ggplot(filter(summer_sample_main_data, Season == 'Summer'), aes(x= Mean_Surf_Temp, y = Summerkill)) +
  geom_jitter(alpha = 0.5, height= 0.05) +
  geom_smooth(method = 'glm', method.args = list(family = 'binomial')) +
  xlab('Temperature') +
  ylab('MME') +
  theme_tufte()
log_plot_summerkill_mean_surf

log_plot_summerkill_AV <- avPlot(logreg_summerkill, variable = 'Mean_Surf_Temp',xlab = 'Mean Surface Temperature | Others', ylab = 'Summerkill | Others')


log_plot_summerkill_AV      

```




# AV plot for Winterkill

Taken from lasso feature selection of winterkill only in modeling.Rmd

```{r sample}

set.seed(1234)

winter_sample_main_data <- merge(filter(main_data, Winterkill == 1), sample_n(filter(main_data, Winterkill == 0), size = 300), all = TRUE)

logreg_winterkill <- glm(Winterkill ~ Mean_Surf_Temp + Season + V2, family = 'binomial', data= winter_sample_main_data)
summary(logreg_winterkill)

logreg_winterkill_one_variable <- glm(Winterkill ~ Mean_Surf_Temp, family = 'binomial', data= filter(main_data, Season == 'Winter'))
summary(logreg_winterkill_one_variable)


```

```{r}

log_plot_winterkill_mean_surf <- ggplot(filter(winter_sample_main_data, Season == 'Winter'), aes(x= Mean_Surf_Temp, y = Winterkill)) +
  geom_jitter(alpha = 0.5, height= 0.05) +
  geom_smooth(method = 'glm', method.args = list(family = 'binomial')) +
  xlab('Temperature') +
  ylab('MME') +
  theme_tufte()
log_plot_winterkill_mean_surf

log_plot_winterkill_AV <- avPlot(logreg_winterkill, variable = 'Mean_Surf_Temp',xlab = 'Mean Surface Temperature | Others', ylab = 'Summerkill | Others')


log_plot_winterkill_AV      

```




# Final projected MME by year & season (include original MME data for concurrent)}



```{r}


plot1<-main_data %>%
  filter(Summerkill == 1) %>%
ggplot(aes(x=factor(Year))) + 
  stat_count()+
  #geom_boxplot(color="black",aes(y=peak_temp, group=Year)) +
  ylab("Actual MMEs")+
  xlab("Period 1") +
  scale_x_discrete()+
  #guides(fill=FALSE) +
  theme_tufte()+
  ylim(0,75) +
  theme(axis.text.x=element_text(angle=90,hjust=1), legend.position = 'left') 
plot1

plot2<-lasso_summer_predictions %>%
  filter(Summerkill_forecast == 1) %>%
  filter(Year <2060 & Year > 2030) %>%
ggplot(aes(x=factor(Year))) +
  stat_count()+
  #geom_boxplot(color="black",aes(y=peak_temp, group=Year)) +
  ylab("Forecasted MMEs")+
  xlab("Period 1") +
  scale_x_discrete()+
  #guides(fill=FALSE) +
  theme_tufte()+
  ylim(0,75) +
  theme(axis.text.x=element_text(angle=90,hjust=1), legend.position = 'left') 
plot2



plot3<- lasso_summer_predictions %>%
  filter(Summerkill_forecast == 1) %>%
  filter(Year >2060) %>%
ggplot(aes(x=factor(Year))) +
  stat_count()+
  #geom_boxplot(color="black",aes(y=peak_temp, group=Year)) +
  ylab(label = NULL)+
  xlab("Period 2") +
  scale_x_discrete()+
  #guides(fill=FALSE) +
  theme_tufte()+
  theme(axis.text.x=element_text(angle=90,hjust=1), legend.position = 'right') +
  ylim(0,75) 
plot3



 grid.arrange(plot1,plot2,plot3, ncol = 3, widths = c(0.6, 1, 1))

```




# spatial mappings

```{r}

Wisconsin_map <- get_map('Stevens Point, Wisconsin', zoom = 7, maptype = 'toner-background', source = 'stamen')
ggmap(Wisconsin_map)

```


```{r concurrent maps}




MME_lakes_of_wisconsin <- ggmap(Wisconsin_map) +
  geom_point(data = filter(main_data, MME == 1), aes(x = V1, V2))


MME_lakes_of_wisconsin_dif_categories <- ggmap(Wisconsin_map) +
  geom_point(data = filter(main_data, MME == 1 & Summerkill == 1), aes(x = V1, V2), fill = 'red', shape = 21) +
  geom_point(data = filter(main_data, MME == 1 & Winterkill == 1), aes(x = V1, V2), fill = 'blue', shape = 21) +
  geom_point(data = filter(main_data, MME == 1 & Infection == 1), aes(x = V1, V2), fill = 'green', shape = 21) +
   geom_point(data = filter(main_data, MME == 1 & Anthropogenic == 1), aes(x = V1, V2), fill = 'orange', shape = 21)

summarized_main_data<-main_data %>%
  group_by(WBIC) %>%
  summarise(MME = max(Summerkill), V1 = mean(V1), V2 = mean(V2))

color_seperated_lakes_of_wisconsin <- ggmap(Wisconsin_map) +
  geom_point(data = arrange(summarized_main_data, MME), aes(x = V1, V2, fill = MME),shape = 21)+
  scale_fill_gradient(low = 'Blue', high = 'Red', limits = c(0, 1.54)) +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        axis.title.y=element_blank(),
        axis.text.y=element_blank(), 
        axis.ticks.y=element_blank())+
  ggtitle('2004-2014')
  #geom_point(data = filter(main_data, MME == 0), aes(x = V1, V2), fill = 'blue', shape = 21)+
  #geom_point(data = filter(main_data, MME == 1), aes(x = V1, V2), fill = 'red', shape = 21)
  
color_seperated_lakes_of_wisconsin

```


```{r future}


summarized_lasso_summer_predictions_p2 <- lasso_summer_predictions %>%
  filter(Year > 2030 & Year < 2070) %>%
  group_by(WBIC) %>%
  summarise(Prob = sum(Prob), V1 = mean(V1), V2 = mean(V2)) 

summarized_lasso_summer_predictions_p3 <- lasso_summer_predictions %>%
  filter(Year > 2070) %>%
  group_by(WBIC) %>%
  summarise(Prob = sum(Prob), V1 = mean(V1), V2 = mean(V2)) 

logreg_at_risk_lakes_of_wisconsin_period_2 <- ggmap(Wisconsin_map) + 
  geom_point(data = arrange(summarized_lasso_summer_predictions_p2, Prob), aes(x = V1, V2, fill = Prob),shape = 21)+
 scale_fill_gradient(low = 'Blue', high = 'Red', limits = c(0, 1.55)) +
    theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        axis.title.y=element_blank(),
        axis.text.y=element_blank(),
        axis.ticks.y=element_blank())+
  ggtitle('2041-2059')
logreg_at_risk_lakes_of_wisconsin_period_2 


logreg_at_risk_lakes_of_wisconsin_period_3 <- ggmap(Wisconsin_map) + 
  geom_point(data = arrange(summarized_lasso_summer_predictions_p3, Prob), aes(x = V1, V2, fill = Prob),shape = 21)+
 scale_fill_gradient(low = 'Blue', high = 'Red', limits = c(0, 1.55)) +
    theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        axis.title.y=element_blank(),
        axis.text.y=element_blank(),
        axis.ticks.y=element_blank())+
  ggtitle('2081-2099')
logreg_at_risk_lakes_of_wisconsin_period_3 


grid.arrange(color_seperated_lakes_of_wisconsin, logreg_at_risk_lakes_of_wisconsin_period_2, logreg_at_risk_lakes_of_wisconsin_period_3, ncol = 2)

```



